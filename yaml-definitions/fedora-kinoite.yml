# Fedora Kinoite (KDE Plasma Atomic) Configuration

name: fedora-kinoite
description: Fedora Kinoite (KDE Plasma) bootc image with custom packages
image-version: 43
image-type: fedora-kinoite

# Base image configuration
base-image: quay.io/fedora/fedora-kinoite:43

# Container metadata
labels:
  org.opencontainers.image.title: "Custom Fedora Kinoite"
  org.opencontainers.image.description: "Custom Fedora Kinoite with KDE Plasma desktop"
  org.opencontainers.image.source: "https://github.com/borninthedark/exousia"
  org.opencontainers.image.licenses: "MIT"
  de: "kde-plasma"
  wm: "kwin"

# Build configuration
build:
  enable_plymouth: true

# Modules define the build steps
modules:
  # SDDM configuration (KDE uses SDDM)
  - type: files
    files:
      - src: custom-configs/sddm/sddm.conf.d/
        dst: /etc/sddm.conf.d/
        mode: "0644"

  # SDDM theme bundles (will be extracted by setup script)
  - type: files
    files:
      - src: custom-configs/sddm/themes/
        dst: /tmp/sddm-themes-source/
        mode: "0644"

  # Extract and configure SDDM themes
  - type: sddm-themes
    source: /tmp/sddm-themes-source
    destination: /usr/share/sddm/themes
    config: /etc/sddm.conf.d/99-theme.conf

  # Package management
  - type: rpm-ostree
    repos:
      - https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-43.noarch.rpm
      - https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-43.noarch.rpm

    install:
      - kitty
      - neovim
      - flatpak
      - htop
      - btop
      - fastfetch

  # Flatpak setup
  - type: script
    scripts:
      - |
        set -euxo pipefail

        # Add Flathub remote at build time (safe, no package installation)
        # This allows tests to verify the remote is configured
        flatpak remote-add --if-not-exists --system flathub \
          https://dl.flathub.org/repo/flathub.flatpakrepo

        echo "âœ“ Flathub remote configured at build time"

  # Chezmoi dotfiles management
  - type: chezmoi
    repository: "https://github.com/borninthedark/dotfiles"
    all-users: true
    file-conflict-policy: skip
    run-every: "1d"
    wait-after-boot: "5m"

  # Enable systemd services
  - type: systemd
    system:
      enabled:
        - bootc-fetch-apply-updates.timer
    user:
      enabled:
        - chezmoi-init.service
        - chezmoi-update.timer

  # Validation
  - type: script
    scripts:
      - bootc container lint
